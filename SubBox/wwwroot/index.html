<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script src="/vue.min.js"></script>
    <script src="/jscolor.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../css/brand-icons.css">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <title>SubBox</title>
    <style>
        .dark-mode {
            background-color: #131313;
            --bg: #131313;
            --nav_bg: #0b0b0b;
            --font_title: #fafafa;
            --font_text: #b8b8b8;
            --video_bd_bot: #969696;
        }

        .light-mode {
            background-color: #fafafa;
            --bg: #fafafa;
            --nav_bg: #ffffff;
            --font_title: #131313;
            --font_text: #969696;
            --video_bd_bot: #969696;
        }

        :root {
            --mainColor: #db4437;
            --secColor: white;
        }

        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            --red: #db4437;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        i {
            margin-right: 2px;
        }

        nav {
            display: flex;
            align-items: center;
            top: 0;
            left: 0;
            right: 0;
            position: fixed;
            width: 100%;
            background-color: var(--nav_bg);
            height: 40px;
            z-index: 2;
        }

        button {
            padding: 5px;
            margin: 5px;
            border: transparent;
            border-radius: 5px;
            background-color: transparent;
            color: var(--font_title);
            cursor: pointer;
        }

        nav button {
            height: 100%;
            width: 40px;
            margin: 0;
            padding: 0;
            border-radius: 0px;
        }

        nav p {
            margin-left: 10px;
            font-size: 22px;
            color: var(--font_title);
        }

        nav button:hover {
            color: var(--secColor);
            background-color: var(--mainColor);
        }

        nav input[type=text] {
            margin: 0px;
            padding: 2px;
            border: solid var(--font_text) 1px;
            width: 250px;
            color: var(--font_title);
            background-color: var(--bg);
        }

            nav input[type=text]:focus, nav input[type=text]:hover {
                border-left: solid var(--mainColor) 1px;
                border-right: solid var(--mainColor) 1px;
                border-top: solid var(--mainColor) 10px;
                border-bottom: solid var(--mainColor) 10px;
            }

        input[type=number] {
            padding: 2px;
            border: solid var(--font_text) 1px;
            border-radius: 0px;
            width: 250px;
            color: #131313;
            -moz-appearance: textfield;
            -webkit-appearance: textfield;
        }

        input[type=text].search {
            display: none;
            background-color: var(--bg);
            padding: 4px;
            border-radius: 5px;
            margin: 0;
            margin-top: 4px;
            height: 18px;
            width: 300px;
        }

            input[type=text].search:focus, input[type=text].search:hover {
                border: solid var(--font_text) 1px;
            }

        tr {
            padding: 0;
        }

        .Title {
            background-color: none;
            margin-top: 8px;
            margin-bottom: 0;
            margin-left: 6px;
            color: var(--font_title);
            cursor: default;
            letter-spacing: 1px;
            font-weight: bold;
            background: linear-gradient(to right, var(--mainColor) 50%, var(--font_title) 50%);
            background-size: 400% 100%;
            background-position: right bottom;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: 1s ease;
        }

        nav:hover .Title {
            color: var(--mainColor);
            font-weight: bold;
            background: linear-gradient(to right,var(--mainColor) 40%, var(--font_title) 40% 65%, var(--mainColor) 65% 75%, var(--font_title) 75%);
            background-size: 400% 100%;
            background-position: left bottom;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: 2s ease;
        }

        .topbar {
            height: 40px;
        }

            .topbar:hover .Title {
                display: none;
            }

            .topbar:hover .search {
                display: flex;
            }

        .search:focus {
            display: flex !important;
        }

            .search:focus ~ .Title {
                display: none !important;
            }

        .channelInput {
            display: flex;
            align-items: center;
            vertical-align: middle;
            height: 100%;
        }

        .refreshButton {
            height: 32px;
            width: 32px;
            margin-left: 4px;
            transition: transform 1s;
            border-radius: 100%;
        }

            .refreshButton:hover {
                transform: rotate(360deg);
                transition: transform 1s;
                border-radius: 100%;
            }

        .videoTitle {
            width: 100%;
            font-size: 18px;
            color: var(--font_title);
            padding-top: 0;
            padding-bottom: 0;
            padding-left: 10px;
            margin: 0;
            cursor: pointer;
        }

        .videoText {
            font-size: 13px;
            color: var(--font_text);
            padding-top: 0;
            padding-bottom: 0;
            padding-left: 10px;
        }

        .videoHeaderName {
            color: var(--font_title);
            display: inline-block;
            cursor: pointer;
            font-size: 16px;
            line-height: 20px;
            font-weight: bold;
            margin-left: 5px;
        }

        .videoList {
            margin-left: auto;
            margin-right: auto;
            width: 60%;
        }

        .videoBox {
            border-bottom-color: var(--video_bd_bot);
            border-bottom-style: solid;
            border-bottom-width: 1px;
        }

            .videoBox:hover .deleteButton {
                color: var(--font_title);
            }

        .deleteButton {
            float: right;
            position: relative;
            color: transparent;
            height: auto;
            margin-top: 50px;
            padding: 1px;
            background: none;
            border: 1px solid var(--bg);
        }

            .deleteButton:hover {
                color: var(--mainColor) !important;
                background-color: var(--secColor);
                border: 1px solid var(--font_title);
            }

        .videoTextChannel {
            cursor: pointer;
        }

            .videoTextChannel:hover {
                color: var(--font_title);
            }

        .videoDesc {
            vertical-align: top;
            padding-left: 10px;
            color: var(--font_text);
            font-size: 13px;
        }

            .videoDesc p {
                max-height: 2.4em;
                line-height: 1.2em;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                display: -webkit-box;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 80%;
            }

        .overlay {
            position: fixed;
            top: 40px;
            margin-left: 0%;
            width: 350px;
            background-color: var(--nav_bg);
            z-index: 2;
            display: block;
            border: 1px solid var(--font_text);
            border-left: none;
            border-top: none;
        }

        .channelList {
            border-collapse: collapse;
            width: 100%;
        }

            .channelList img {
                margin-top: 5px;
                margin-bottom: 5px;
                margin-left: 10px;
                width: 32px;
                height: 32px;
                border-radius: 50%;
                vertical-align: middle;
                cursor: pointer;
            }

        .channelNameColumn {
            color: var(--font_title);
            padding-left: 10px;
            width: 250px;
        }

        .channelButtonColumn {
            width: 100px;
        }

        .channelRow {
            border-left: 5px transparent solid;
            background: linear-gradient(to right, var(--mainColor) 50%, transparent 50%);
            background-size: 200% 100%;
            background-position: right bottom;
            transition: 0.2s ease, border 0.4s;
        }

            .channelRow:hover {
                border-left: 5px var(--mainColor) solid;
                background: linear-gradient(to right, var(--mainColor) 50%, transparent 50%);
                background-size: 200% 100%;
                background-position: left bottom;
                transition: 0.4s ease, border 0s;
            }

                .channelRow:hover td {
                    color: var(--secColor) !important;
                }

                .channelRow:hover button {
                    color: var(--secColor);
                }

        .locked {
            border-left: 5px #daa520 solid;
            background: linear-gradient(to right, #daa520 50%, transparent 50%);
            background-size: 200% 100%;
            background-position: right bottom;
            transition: 0.2s ease;
        }

            .locked:hover {
                border-left: 5px #daa520 solid;
                background: linear-gradient(to right, #daa520 50%, transparent 50%);
                background-size: 200% 100%;
                background-position: left bottom;
                transition: 0.4s ease;
            }

                .locked:hover .deleteChannelButton:hover {
                    color: #daa520 !important;
                }

        button.deleteChannelButton:hover {
            padding: 0 !important;
            color: var(--mainColor);
            background: linear-gradient(to top, var(--secColor) 50%, transparent 50%);
            background-size: 100% 200%;
            background-position: right bottom;
            transition: 0.2s;
        }

        .deleteChannelButton {
            display: inline-block;
            border-radius: 2px;
            padding: 0 !important;
            color: transparent;
            background: linear-gradient(to top, var(--secColor) 50%, transparent 50%);
            background-size: 100% 200%;
            background-position: right top;
            transition: background 0.1s;
        }

        .closeChannelsButton {
            float: right;
            border-radius: 5px;
            background: linear-gradient(to right, var(--mainColor) 50%, transparent 50%);
            background-size: 200% 100%;
            background-position: right bottom;
            transition: 0.1s ease;
        }

            .closeChannelsButton:hover {
                color: var(--secColor);
                border-radius: 5px;
                background: linear-gradient(to right, var(--mainColor) 50%, transparent 50%);
                background-size: 200% 100%;
                background-position: left bottom;
                transition: 0.2s ease;
            }

        .listList {
            margin-left: auto;
            margin-right: auto;
            width: 60%;
        }

        .spacer {
            display: flex;
            width: 100%;
            margin-top: 40px;
            height: 30px;
        }

        .videoBox:hover .listButton {
            color: var(--font_title);
        }

        .listButton {
            padding: 2px;
            color: transparent;
            background-color: transparent;
            border: 1px solid transparent;
        }

            .listButton:hover {
                color: var(--mainColor) !important;
                background-color: var(--secColor);
                border: 1px solid var(--font_title);
            }

        .inputList {
            display: flex;
            align-items: center;
            height: 100%;
        }

        .overlayUniqueList {
            position: fixed;
            top: 40px;
            margin-left: 0;
            width: 100%;
            height: 97%;
            background-color: var(--bg);
            z-index: 2;
            display: flex;
            padding: 0;
        }

        .scrollList {
            width: 100%;
            overflow: auto;
            margin: 0;
        }

        .uniqueList {
            margin-left: auto;
            margin-right: auto;
            width: 60%;
        }

        .closeUniqueListButton {
            margin-left: auto;
            margin-right: 0;
        }

            .closeUniqueListButton:hover {
                color: var(--secColor);
                transition: 0.2s;
            }

        .playlistHint {
            color: var(--mainColor);
            font-size: 12px;
            border: 1px var(--mainColor) solid;
            font-weight: 500;
            margin-left: 10px;
            display: inline-block;
            padding-top: 2px;
            padding-bottom: 2px;
            padding-left: 3px;
            padding-right: 3px;
            line-height: 12px;
            cursor: default;
        }

        .settingsOverlay {
            position: fixed;
            top: 40px;
            margin-left: 80%;
            width: 20%;
            background-color: var(--nav_bg);
            z-index: 2;
            display: block;
            border: 1px solid var(--font_text);
            border-right: none;
            border-top: none;
        }

            .settingsOverlay p {
                text-align: center;
                color: var(--font_title);
                margin: 0;
            }

            .settingsOverlay table {
                width: 100%;
                border-collapse: collapse;
            }

            .settingsOverlay td {
                justify-items: center;
                width: 50%;
                color: var(--font_title);
                padding-left: 10px;
            }

            .settingsOverlay tr:hover td {
                background-color: var(--bg);
            }

            .settingsOverlay td:first-of-type {
                padding-top: 5px;
                padding-bottom: 5px;
            }

            .settingsOverlay tr:nth-child(2) td {
                padding-top: 5px;
            }

            .settingsOverlay button {
                float: right;
            }

        .numberInput button:hover {
            color: var(--secColor);
            background: linear-gradient(to top, var(--mainColor) 50%, transparent 50%);
            background-size: 100% 200%;
            background-position: right bottom;
            transition: 0.2s ease;
        }

        .settingsOverlay input {
            width: 35%;
            margin: 0;
            padding: 0;
            font-size: 16px;
            text-align: center;
            border: 1px var(--font_title) solid;
            border-radius: 0;
        }

        .numberInput {
            box-sizing: border-box;
            justify-content: center;
            display: inline-flex;
            padding: 0;
        }

            .numberInput button {
                align-items: center;
                justify-content: center;
                border: 1px var(--font_title) solid;
                border-radius: 0;
                cursor: pointer;
                margin: 0;
                padding: 0;
                position: relative;
                background: linear-gradient(to top, var(--mainColor) 50%, transparent 50%);
                background-size: 100% 200%;
                background-position: right top;
                transition: background 0.1s ease;
            }

        .videoThumb {
            position: relative;
            cursor: pointer;
        }

            .videoThumb p {
                font-size: 12px;
                font-weight: 500;
                bottom: -6px;
                right: 3px;
                color: white;
                background: rgba(0,0,0,0.8);
                position: absolute;
                padding-left: 4px;
                padding-right: 4px;
                padding-top: 2px;
                padding-bottom: 2px;
                border-radius: 2px;
            }

        .changeWarning {
            margin-top: 4px !important;
            cursor: default;
            float: left;
            width: 180px;
            padding: 3px;
            border-radius: 2px;
            color: var(--secColor) !important;
            font-size: 18px;
            border: 1px solid var(--font_title);
            background: linear-gradient(to right, var(--mainColor) 50%, transparent 50%);
            background-size: 200% 100%;
            background-position: left bottom;
        }

        .fade-enter-active {
            transition: 0.3s;
        }

        .fade-leave-active {
            transition: 0s;
        }

        .fade-enter, .fade-leave-to {
            background-position: right bottom;
        }

        .bottomDiv {
            text-align: center;
        }

        .bottomDivEntry {
            text-decoration: none;
            cursor: pointer;
            font-size: 12px;
            color: var(--font_title);
            margin: 20px;
            display: inline-flex;
        }

            .bottomDivEntry:hover {
                color: var(--font_text);
            }

        .addTagDiv {
            width: 100%;
            height: 24px;
            display: flex;
            vertical-align: central;
            padding: 3px;
            margin-bottom: 10px;
        }

        .addTagInput {
            padding: 2px;
            margin-left: 10px;
            width: 75%;
            height: 100%;
            background: var(--bg);
            color: var(--font_title);
            border: 1px solid var(--font_text);
        }

        .addTagButton {
            border-radius: 0;
            margin: 0;
            padding: 0;
            width: 30px;
            height: 30px;
            border: 1px solid var(--font_text);
        }

                .addTagButton:hover {
                    background: var(--mainColor);
                    color: var(--secColor);
                }

        .addTagFilterDiv {
            width: 100%;
            height: 24px;
            display: flex;
            vertical-align: central;
            padding: 3px;
            margin-bottom: 10px;
        }

        .addTagFilterInput {
            padding: 2px;
            margin-left: 15px;
            width: 75%;
            height: 100%;
            background: var(--bg);
            color: var(--font_title);
            border: 1px solid var(--font_text);
        }

        .addTagFilterButton {
            border-radius: 0;
            margin: 0;
            padding: 0;
            width: 30px;
            height: 30px;
            border: 1px solid var(--font_text);
        }

            .addTagFilterButton:hover {
                background: var(--mainColor);
                color: var(--secColor);
            }

        .tagFilterTable {
            width: 100%;
            border-collapse: collapse;
            color: var(--font_title);
        }

            .tagFilterTable tr {
                padding: 3px;
            }

            .tagFilterTable td {
                padding-left: 20px;
            }

                .tagFilterTable tr:hover {
                    background: var(--nav_bg);
                    color: var(--font_title);
                }

                .tagFilterTable tr:hover button {
                    color: var(--font_title);
                }

        .tagFilterRow {
            background: var(--bg);
            border-right: 1px solid var(--font_title);
        }

        .selectedTag {
            cursor: default;
            border-radius: 4px;
            padding: 4px;
            font-size: 16px;
            background: var(--mainColor);
            color: var(--secColor);
        }
        .deleteTagFilterButton {
            border-radius: 0;
            padding: 0;
            float: right;
            width: 24px;
            height: 24px;
            color: transparent;
            background: transparent;
        }

        button.deleteTagFilterButton:hover {
            background: var(--mainColor);
            color: var(--secColor) !important;
        }
    </style>
</head>

<body>
    <div id="app" :class="night ? 'dark-mode' : 'light-mode'">

        <div v-show="tagsMode" class="overlay">
            <div class="addTagDiv">
                <input class="addTagInput" v-model="addTag" type="text" autocomplete="off" placeholder="Enter Tag Name..."/>
                <button @click="submitTag" class="material-icons addTagButton">add</button>
            </div>
            <table class="channelList" v-for="tag in tags">
                <tr v-bind:class="{ locked: selectedTag != null && selectedTag.name == tag.name }" class="channelRow">
                    <td class="channelNameColumn" style="width: 200px">
                        {{tag.name}}
                    </td>
                    <td class="channelButtonColumn">
                        <button @click="selectTag(tag)" class="material-icons deleteChannelButton">star</button>
                        <button @click="editTag(tag)" class="material-icons deleteChannelButton">create</button>
                        <button @click="deleteTag(tag)" class="material-icons deleteChannelButton">clear</button>
                    </td>
                </tr>
                <tr class="tagFilterRow" v-if="tag.inEdit">
                    <td colspan="2">
                        <table class="tagFilterTable" v-for="(tagFilter,index) in tag.filterList">
                            <tr>
                                <td style="width: 80%">
                                    {{index + 1}}: {{tagFilter}}
                                </td>
                                <td>
                                    <button @click="deleteFilter(tag,tagFilter)" style="float: right;" class="material-icons deleteTagFilterButton">clear</button>
                                </td>
                            </tr>
                        </table>
                        <div class="addTagFilterDiv">
                            <input class="addTagFilterInput" v-model="addTagFilter" type="text" autocomplete="off" placeholder="Enter Filter..." />
                            <button @click="addFilterToTag(tag)" class="material-icons addTagFilterButton">add</button>
                        </div>
                        <button @click="saveFilters(tag)" class="material-icons closeChannelsButton">save</button>
                    </td>
                </tr>
            </table>
            <button @click="showTags" class="material-icons closeChannelsButton">exit_to_app</button>
        </div>




        <div v-show="channelMode" class="overlay">
            <table class="channelList" v-for="channel in channels">
                <tr v-bind:class="{ locked: channel.locked }" class="channelRow">
                    <td>
                        <img :src="channel.thumbnailUrl" @click="openChannel(channel.username)" />
                    </td>
                    <td class="channelNameColumn">
                        {{channel.displayname}}
                    </td>
                    <td class="channelButtonColumn">
                        <button @click="setFilter(channel)" class="material-icons deleteChannelButton">star</button>
                        <button @click="deleteChannel(channel)" class="material-icons deleteChannelButton">clear</button>
                    </td>
                </tr>
            </table>
            <button @click="closeChannels" class="material-icons closeChannelsButton">exit_to_app</button>
        </div>

        <div v-show="settingsMode" class="settingsOverlay">
            <table>
                <tr style="border-bottom: 1px solid var(--font_title)">
                    <td colspan="2">
                        <p>SubBox - Settings</p>
                    </td>
                </tr>
                <tr>
                    <td>Channel Retrieval (Days)</td>
                    <td>
                        <div class="numberInput">
                            <button @click="changeSetting('NCT',-1)" class="material-icons" style="margin-left: 25%">remove</button>
                            <input v-model="settingNCT" type="number" id="NCT" name="NCT" min="1" max="30" />
                            <button @click="changeSetting('NCT',+1)" class="material-icons">add</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Retrieval Time (Days)</td>
                    <td>
                        <div class="numberInput">
                            <button @click="changeSetting('RT',-1)" class="material-icons" style="margin-left: 25%">remove</button>
                            <input v-model="settingRT" type="number" id="RT" name="RT" min="1" max="7" />
                            <button @click="changeSetting('RT',+1)" class="material-icons">add</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Deletion Time (Days)</td>
                    <td>
                        <div class="numberInput">
                            <button @click="changeSetting('DT',-1)" class="material-icons" style="margin-left: 25%">remove</button>
                            <input v-model="settingDT" type="number" id="DT" name="DT" min="7" />
                            <button @click="changeSetting('DT',+1)" class="material-icons">add</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Playlist Playback Size</td>
                    <td>
                        <div class="numberInput">
                            <button @click="changeSetting('PPS',-1)" class="material-icons" style="margin-left: 25%">remove</button>
                            <input v-model="settingPPS" type="number" id="PPS" name="PPS" min="1" />
                            <button @click="changeSetting('PPS',+1)" class="material-icons">add</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Accent Color</td>
                    <td>
                        <div class="numberInput">
                            <button @click="resetColor" class="material-icons" style="margin-left: 25%">replay</button>
                            <input v-model="settingColor" id="colorPicker" @change="setColor()" class="jscolor" />
                            <button class="material-icons" style="color: transparent; background: transparent; cursor: default; border: transparent;">add</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <transition name="fade">
                            <p class="changeWarning" v-if="changes">Unsaved Changes!</p>
                        </transition>
                        <button @click="closeSettings" class="material-icons closeChannelsButton">save</button>
                    </td>
                </tr>
            </table>
        </div>

        <div v-show="uniqueListMode" class="overlayUniqueList">
            <nav>
                <p>Playlist Contents</p><p class="material-icons">view_list</p><p>|</p>
                <p class="Title" style="margin-top:0; margin-right: 6px">{{uniqueList.length}} Video{{(uniqueList.length != 1) ? 's' : ''}}</p>
                <button @click="showListInput()" class="material-icons">playlist_add</button>
                <div v-show="inputListMode" class="inputList">
                    <input v-model="addPlayList" autocomplete="off" type="text" name="PlaylistIdUnqiue" placeholder="Playlist Id..." />
                    <button @click="submitPlaylist" class="material-icons">search</button>
                </div>
                <button @click="closeUniqueList" class="material-icons closeUniqueListButton">exit_to_app</button>
            </nav>

            <div class="scrollList">
                <table class="uniqueList">
                    <tr v-for="video in uniqueList">
                        <td>
                            <div class="videoBox">
                                <table style="display: inline-block; border-collapse: collapse; width:90%">
                                    <tr class="videoRows">
                                        <th rowspan="3">
                                            <div @click="openVideo(video.id)" class="videoThumb">
                                                <img :src="video.thumbnailUrl" style="width:246px;height:138px" />
                                                <p>{{video.duration}}</p>
                                            </div>
                                        </th>
                                        <td @click="openVideo(video.id)" class="videoTitle">
                                            {{video.title}}
                                        </td>
                                    </tr>
                                    <tr class="videoRows">
                                        <td class="videoText">
                                            <span class="videoTextChannel" @click="openChannel(video.channelName)">{{video.channelTitle}}</span> &#9679 {{video.publishedAtString}}
                                        </td>
                                    </tr>
                                    <tr style="height:100px">
                                        <td class="videoDesc">
                                            <p style="margin-top:5px">{{video.description}} </p>
                                        </td>
                                    </tr>
                                </table>
                                <button class="material-icons deleteButton" style="margin-top: 0" @click="deleteVideo(video)">clear</button>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div v-show="trashbinMode" class="overlayUniqueList">
            <nav>
                <p>Removed Videos</p><p class="material-icons">view_list</p><p>|</p>
                <p class="Title" style="margin-top:0;">{{oldVideos.length}} Video{{(oldVideos.length != 1) ? 's' : ''}}</p>
                <button @click="closeTrashbin" class="material-icons closeUniqueListButton">exit_to_app</button>
            </nav>
            <div class="scrollList">
                <table class="uniqueList">
                    <tr v-for="video in oldVideos">
                        <td>
                            <div class="videoBox">
                                <table style="display: inline-block; border-collapse: collapse; width:90%">
                                    <tr>
                                        <th style="display:inline-block;padding:10px">
                                            <img :src="video.channelPicUrl" style="left:0;width:32px;height:32px;border-radius: 50%;vertical-align:middle;cursor:pointer;" @click="openChannel(video.channelName)" />
                                            <span class="videoHeaderName" @click="openChannel(video.channelName)">{{video.channelTitle}}</span>
                                        </th>
                                    </tr>
                                    <tr class="videoRows">
                                        <th rowspan="3">
                                            <div @click="openVideo(video.id)" class="videoThumb">
                                                <img :src="video.thumbnailUrl" style="width:246px;height:138px" />
                                                <p>{{video.duration}}</p>
                                            </div>
                                        </th>
                                        <td @click="openVideo(video.id)" class="videoTitle">
                                            {{video.title}}
                                        </td>
                                    </tr>
                                    <tr class="videoRows">
                                        <td class="videoText">
                                            <span class="videoTextChannel" @click="openChannel(video.channelName)">{{video.channelTitle}}</span> &#9679 {{video.publishedAtString}}
                                        </td>
                                    </tr>
                                    <tr style="height:100px">
                                        <td class="videoDesc">
                                            <p style="margin-top:5px">{{video.description}} </p>
                                        </td>
                                    </tr>
                                </table>
                                <button class="material-icons deleteButton" @click="reactivateVideo(video)">add</button>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <nav v-show="videoListMode">
            <button @click="showChannelInput" class="material-icons">add_box</button>
            <div v-show="inputMode" class="channelInput">
                <input v-model="addChannelName" autocomplete="off" type="text" name="Username" placeholder="Channel Name..." />
                <button class="material-icons" @click="onSubmit">search</button>
            </div>
            <button @click="showChannels" class="material-icons">{{(filter === 'SubBox') ? 'account_box' : 'star'}}</button>
            <button @click="showListInput()" class="material-icons">playlist_add</button>
            <div v-show="inputListMode" class="inputList">
                <input v-model="addPlayList" autocomplete="off" type="text" name="PlaylistId" placeholder="Playlist Id..." />
                <button @click="submitPlaylist" class="material-icons">search</button>
            </div>
            <button @click="showOldVideos" class="material-icons">delete</button>
            <button @click="showTags" class="material-icons">label</button>
            <p class="selectedTag" v-if="selectedTag != null">{{selectedTag.name}}</p>
            <div class="topbar" style="margin-left: auto">
                <input class="search" v-model="searchFilter" type="text" autocomplete="off" placeholder="Search" />
                <p class="Title" style="cursor: default;">{{filter}} - {{filteredVideos.length}}</p>
            </div>

            <button style="margin-left: auto" @click="switchDesign" class="material-icons">highlight</button>
            <button @click="showSettings" class="material-icons">settings_applications</button>
            <button @click="refresh" class="material-icons refreshButton">autorenew</button>
        </nav>

        <div class="spacer">

        </div>
        <table v-show="videoListMode && filter==='SubBox' && searchFilter === ''" class="listList">
            <tr v-for="video in lists">
                <td>
                    <div class="videoBox">
                        <table>
                            <tr class="videoRows">
                                <th rowspan="4">
                                    <div @click="openVideo(video.id)" class="videoThumb">
                                        <img :src="video.thumbnailUrl" style="width:246px;height:138px" />
                                        <p>{{video.duration}}</p>
                                    </div>
                                </th>
                                <td @click="openVideo(video.id)" class="videoTitle">
                                    {{video.title}}
                                </td>
                            </tr>
                            <tr class="videoRows">
                                <td class="videoText">
                                    <span class="videoTextChannel" @click="openChannel(video.channelName)">{{video.channelTitle}}</span> &#9679 {{video.publishedAtString}}
                                </td>
                            </tr>
                            <tr style="height:50px">
                                <td class="videoDesc">
                                    <p style="margin-top:5px">{{video.description}}</p>
                                </td>
                            </tr>
                            <tr>
                                <td style="display: flex;">
                                    <p class="playlistHint">PLAYLIST</p>
                                    <button @click="prev(video.list)" style="margin-left: auto" class="material-icons listButton">fast_rewind</button>
                                    <button @click="next(video.list)" class="material-icons listButton">fast_forward</button>
                                    <button @click="showUniqueList(video.list)" class="material-icons listButton">view_list</button>
                                </td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
        <table v-show="videoListMode" class="videoList">
            <tr v-for="video in filteredVideos">
                <td>
                    <div class="videoBox">
                        <table style="display: inline-block; border-collapse: collapse; width:90%">
                            <tr>
                                <th style="display:inline-block;padding:10px">
                                    <img :src="video.channelPicUrl" style="left:0;width:32px;height:32px;border-radius: 50%;vertical-align:middle;cursor:pointer;" @click="openChannel(video.channelName)" />
                                    <span class="videoHeaderName" @click="openChannel(video.channelName)">{{video.channelTitle}}</span>
                                </th>
                            </tr>
                            <tr class="videoRows">
                                <th rowspan="3">
                                    <div @click="openVideo(video.id)" class="videoThumb">
                                        <img :src="video.thumbnailUrl" style="width:246px;height:138px" />
                                        <p>{{video.duration}}</p>
                                    </div>
                                </th>
                                <td @click="openVideo(video.id)" class="videoTitle">
                                    {{video.title}}
                                </td>
                            </tr>
                            <tr class="videoRows">
                                <td class="videoText">
                                    <span class="videoTextChannel" @click="openChannel(video.channelName)">{{video.channelTitle}}</span> &#9679 {{video.publishedAtString}}
                                </td>
                            </tr>
                            <tr style="height:100px">
                                <td class="videoDesc">
                                    <p style="margin-top:5px">{{video.description}}</p>
                                </td>
                            </tr>
                        </table>
                        <button class="material-icons deleteButton" @click="deleteVideo(video)">clear</button>
                    </div>
                </td>
            </tr>
        </table>
        
        <div class="bottomDiv">
            <a target="_blank" rel="noopener noreferrer" href="https://github.com/MilchRatchet/SubBox" class="bottomDivEntry"><i class="bd-github"></i> Github</a>
            <a href="http://localhost:5000/tutorial.html" class="bottomDivEntry"><i class="bd-html5"></i>Introduction</a>
            <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/" class="bottomDivEntry"><i class="bd-youtube"></i>Youtube</a>
        </div>
    </div>


<script>
    var app = new Vue({
        data: {
            videos: [],
            oldVideos: [],
            channels: [],
            lists: [],
            uniqueList: [],
            tags: [],
            videoListMode: true,
            inputMode: false,
            trashbinMode: false,
            inputListMode: false,
            tagsMode: false,
            inputListModeNumber: 0,
            addPlayList: "",
            addTag: "",
            addTagFilter: "",
            channelMode: false,
            uniqueListMode: false,
            addChannelName: "",
            night: false,
            filter: "SubBox",
            searchFilter: "",
            selectedTag: null,
            settingsMode: false,
            settingNCT: 1,
            settingRT: 7,
            settingDT: 7,
            settingPPS: 50,
            settingColor: "ff0000",
            settings: [],
            changes: false,
        },
        computed: {
            filteredVideos: function () {
                if (this.filter === "SubBox" && this.searchFilter === "" && (this.selectedTag == null || this.selectedTag.filterList.length == 0)) {
                    return this.videos;
                }
                searchFilterUp = this.searchFilter.toUpperCase();
                if (this.filter === "SubBox" && (this.selectedTag == null || this.selectedTag.filterList.length == 0)) {
                    return this.videos.filter(function (u) {
                        return (u.title + u.description).toUpperCase().includes(searchFilterUp);
                    });
                }
                if (this.filter === "SubBox") {
                    return this.videos.filter(function (u) {
                        return ((u.title + u.description).toUpperCase().includes(searchFilterUp) && app.selectedTag.filterList.some(function(f) {
                            return (u.title + u.description).toUpperCase().includes(f.toUpperCase());
                        }));
                    });
                }
                if (this.selectedTag == null || this.selectedTag.filterList.length == 0) {
                    return this.videos.filter(function (u) {
                        return (u.channelTitle == app.filter && (u.title + u.description).toUpperCase().includes(searchFilterUp));
                    });
                }
                return this.videos.filter(function (u) {
                    return (u.channelTitle == app.filter && (u.title + u.description).toUpperCase().includes(searchFilterUp) && app.selectedTag.filterList.some(function(f) {
                        return (u.title + u.description).toUpperCase().includes(f.toUpperCase());
                    }));
                });
            },
        },
        functions: {

        },
        methods: {
            async update() {
                var result = await fetch("/api/values/videos");

                this.videos = await result.json();
            },
            async listUpdate() {
                var result = await fetch("/api/values/lists");

                this.lists = await result.json();
            },
            async tagsUpdate() {
                var result = await fetch("/api/values/tags");

                this.tags = await result.json();

                this.tags.forEach(function (t) {
                    if (t.filter == "") {
                        t.filterList = [];
                    } else {
                        t.filterList = t.filter.split("§");
                    }
                    t.inEdit = false;
                });

                this.tags.sort();
            },
            async getSettings() {
                var result = await fetch("/api/values/settings");

                this.settings = await result.json();

                this.settingRT = this.settings[0];

                this.settingNCT = this.settings[1];

                this.settingDT = this.settings[2];

                this.settingPPS = this.settings[3];

                this.settingColor = this.settings[4];

                document.documentElement.style.setProperty('--mainColor', "#" + this.settingColor);

                document.getElementById("colorPicker").jscolor.fromString(this.settingColor);

                this.setSecondColor();

                this.night = (this.settings[5] == "True");

                this.setBodyColor();
            },
            showChannelInput() {
                this.inputListMode = false;

                this.inputMode = !this.inputMode;

                this.addChannelName = "";
            },
            showListInput() {
                this.inputMode = false;

                this.addPlayList = "";

                this.addPlayListUnique = "";

                this.inputListMode = !this.inputListMode;
            },
            async showUniqueList(number) {
                if (number > 0) {
                    this.uniqueList = null;

                    var waiter = fetch("/api/values/list/all/" + number);

                    this.inputListModeNumber = number;

                    this.channelMode = false;

                    this.uniqueListMode = true;

                    this.videoListMode = false;

                    var result = await waiter;

                    this.uniqueList = await result.json();
                }
            },
            async showOldVideos() {
                var waiter = fetch("api/values/videos/old");

                this.channelMode = false;

                this.trashbinMode = true;

                this.videoListMode = false;

                var result = await waiter;

                this.oldVideos = await result.json();
            },
            showSettings() {
                this.changes = false;

                this.getSettings();

                this.settingsMode = !this.settingsMode;
            },
            showTags() {
                this.channelMode = false;

                if (this.tagsMode) {
                    this.tags.forEach(function (t) {
                        t.inEdit = false;
                    });
                }

                this.tagsMode = !this.tagsMode;
            },
            async refresh() {
                await fetch("/api/values/refresh", { method: "POST", });

                this.update();
            },
            setColor() {
                this.settingColor = document.getElementById('colorPicker').value;

                document.documentElement.style.setProperty('--mainColor', "#" + this.settingColor);

                this.setSecondColor();

                this.changes = true;
            },
            resetColor() {
                this.settingColor = "DB4437";

                document.getElementById("colorPicker").jscolor.fromString(this.settingColor);

                document.documentElement.style.setProperty('--mainColor', "#" + this.settingColor);

                this.setSecondColor();

                this.changes = true;
            },
            async submitTag() {
                if (this.addTag != "") {
                    this.addTag = this.addTag.trim();

                    await fetch("api/values/tags/add/" + this.addTag, { method: "POST" });

                    this.addTag = "";

                    this.tagsUpdate();
                }
            },
            async onSubmit() {
                if (this.addChannelName != "") {
                    this.addChannelName = this.addChannelName.trim();

                    this.inputMode = false;

                    this.channelMode = false;

                    await fetch("/api/values/channel/" + this.addChannelName, { method: "POST" });

                    this.addChannelName = "";

                    this.update();
                }
            },
            async submitPlaylist() {
                if (this.addPlayList != "") {
                    this.addPlayList = this.addPlayList.trim();

                    this.inputListMode = false;

                    if (!Number.isInteger(this.inputListModeNumber)) {
                        console.log(this.inputListModeNumber);
                    }

                    await fetch("/api/values/list/add/" + this.addPlayList + "/" + this.inputListModeNumber, { method: "POST" });

                    this.addPlayList = "";

                    this.listUpdate();

                    if (this.uniqueListMode) {
                        this.showUniqueList(this.inputListModeNumber);
                    }
                }
            },
            openVideo(link) {
                window.open("https://www.youtube.com/watch?v=" + link, "_blank");
            },
            async deleteVideo(video) {
                if (this.uniqueListMode) {
                    var waiter = fetch("/api/values/video/" + video.id, { method: "DELETE" });

                    var index = this.uniqueList.indexOf(video);

                    this.uniqueList.splice(index, 1);

                    await waiter;

                    this.listUpdate();
                } else {
                    var waiter = fetch("/api/values/video/" + video.id, { method: "DELETE" });

                    var index = this.videos.indexOf(video);

                    this.videos.splice(index, 1);
                }
            },
            async reactivateVideo(video) {
                var waiter = fetch("/api/values/video/" + video.id, { method: "POST" });

                var index = this.oldVideos.indexOf(video);

                this.oldVideos.splice(index, 1);

                await waiter;

                this.update();
            },
            openChannel(link) {
                window.open("https://www.youtube.com/user/" + link, "_blank");
            },
            async showChannels() {
                var waiter = fetch("/api/values/channels");

                if (this.tagsMode) {
                    this.showTags();
                }

                this.channelMode = !this.channelMode;

                var result = await waiter;

                this.channels = await result.json();

                this.unlockAllChannels();

                if (this.filter === "SubBox") {
                    return;
                }

                this.channels.find(function (e) {
                    return e.displayname === app.filter;
                }).locked = true;
            },
            unlockAllChannels() {
                this.channels.forEach(function (c) {
                    c.locked = false;
                });
            },
            lockChannel(ch) {
                if (ch.locked) {
                    ch.locked = false;
                    return;
                }

                this.unlockAllChannels();

                ch.locked = true;
            },
            closeChannels() {
                this.channelMode = false;
            },
            closeUniqueList() {
                this.inputListModeNumber = 0;

                this.videoListMode = true;

                this.uniqueListMode = false;
            },
            closeTrashbin() {
                this.videoListMode = true;

                this.trashbinMode = false;
            },
            async closeSettings() {
                this.settingRT = document.getElementById('RT').value;

                this.settingNCT = document.getElementById('NCT').value;

                this.settingDT = document.getElementById('DT').value;

                this.settingPPS = document.getElementById('PPS').value;
                
                this.settingsMode = false;

                this.changes = false;

                await Promise.all([fetch("/api/values/settings/RT/" + this.settingRT, { method: "POST" }),

                fetch("/api/values/settings/NCT/" + this.settingNCT, { method: "POST" }),

                fetch("/api/values/settings/DT/" + this.settingDT, { method: "POST" }),

                fetch("/api/values/settings/PPS/" + this.settingPPS, { method: "POST" }),

                fetch("/api/values/settings/COLOR/" + this.settingColor, { method: "POST" })]);

                fetch("/api/values/settings/save", { method: "POST" });
            },
            async switchDesign() {
                this.night = !this.night;

                this.setBodyColor();

                await fetch("/api/values/settings/NIGHT/" + null, { method: "POST" });

                fetch("/api/values/settings/save", { method: "POST" });
            },
            setBodyColor() {
                if (this.night) {
                    document.body.setAttribute('bgcolor', '#131313');
                } else {
                    document.body.setAttribute('bgcolor', '#fafafa');
                }
            },
            async deleteChannel(channel) {
                if (channel.displayname == this.filter) {
                    this.filter = "SubBox";
                }

                var waiter = fetch("/api/values/channel/" + channel.id, { method: "DELETE" });

                var index = this.channels.indexOf(channel);

                this.channels.splice(index, 1);

                await waiter;

                this.update();
            },
            async next(list) {
                await fetch("api/values/list/next/" + list, { method: "POST" });

                this.listUpdate();
            },
            async prev(list) {
                await fetch("api/values/list/previous/" + list, { method: "POST" });

                this.listUpdate();
            },
            changeSetting(setting, number) {
                this.changes = true;

                switch (setting) {
                    case "NCT": 
                        this.settingNCT *= 1;

                        this.settingNCT += number;

                        if (this.settingNCT > 90) {
                            this.settingNCT = 90;
                        }

                        else if (this.settingNCT < 1) {
                            this.settingNCT = 1;
                        }
                        
                        break;
                    case "RT":
                        this.settingRT *= 1;

                        this.settingRT += number;

                        if (this.settingRT > 7) {
                            this.settingRT = 7;
                        }
                        else if (this.settingRT < 1) {
                            this.settingRT = 1;
                        }

                        break;
                    case "DT": 
                        this.settingDT *= 1;

                        this.settingDT += number;

                        if (this.settingDT < 7) {
                            this.settingDT = 7;
                        }

                        break;
                    case "PPS":
                        this.settingPPS *= 1;

                        this.settingPPS += number;

                        if (this.settingPPS < 1) {
                            this.settingPPS = 1;
                        }

                        break;
                    default:
                        console.log("Unknown setting was tried to change!");

                        console.log(setting);

                        this.changes = false;
                }
            },
            setSecondColor() {
                var r = parseInt(this.settingColor.substr(0, 2), 16);
                var g = parseInt(this.settingColor.substr(2, 2), 16);
                var b = parseInt(this.settingColor.substr(4, 2), 16);
                var yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
                if (yiq >= 200) {
                    document.documentElement.style.setProperty('--secColor', 'black');
                } else {
                    document.documentElement.style.setProperty('--secColor', 'white');
                }
            },
            setFilter(ch) {
                if (ch.displayname == this.filter) {
                    this.filter = "SubBox";
                } else {
                    this.filter = ch.displayname;
                }

                this.lockChannel(ch);
            },
            selectTag(tag) {
                if (this.selectedTag == null) {
                    this.selectedTag = tag;

                    return;
                }
                if (this.selectedTag.name == tag.name) {
                    this.selectedTag = null;

                    return;
                }
                this.selectedTag = tag;
            },
            deleteTag(tag) {
                if (this.selectedTag != null && this.selectedTag.name == tag.name) {
                    this.selectedTag = null;
                }

                fetch("/api/values/tags/delete/" + tag.name, { method: "DELETE" });

                var index = this.tags.indexOf(tag);

                this.tags.splice(index, 1);
            },
            editTag(tag) {
                if (tag.inEdit) {
                    this.saveFilters(tag);
                    return;
                }

                this.tags.forEach(function (t) {
                    t.inEdit = t.name == tag.name;
                });

                this.tags.sort();
            },
            async addFilterToTag(tag) {
                if (this.addTagFilter != "") {
                    tag.filterList.push(this.addTagFilter);

                    this.addTagFilter = "";

                    var forceUpdateTag = this.selectedTag;

                    this.selectedTag = null;

                    this.selectedTag = forceUpdateTag;

                    tag.filter = tag.filterList.join('§');

                    fetch("/api/values/tags/set/" + tag.name + "/§" + tag.filter, { method: "POST" });

                }     
            },
            async saveFilters(tag) {
                var forceUpdateTag = this.selectedTag;

                this.selectedTag = null;

                this.selectedTag = forceUpdateTag;

                tag.filter = tag.filterList.join('§');

                fetch("/api/values/tags/set/" + tag.name + "/§" + tag.filter, { method: "POST" });

                this.tags.forEach(function (t) {
                    t.inEdit = false;
                });

                this.tags.sort();
            },
            async deleteFilter(tag, filter) {
                var index = tag.filterList.indexOf(filter);

                this.$delete(tag.filterList, index);

                var forceUpdateTag = this.selectedTag;

                this.selectedTag = null;

                this.selectedTag = forceUpdateTag;

                tag.filter = tag.filterList.join('§');

                fetch("/api/values/tags/set/" + tag.name + "/§" + tag.filter, { method: "POST" });

                this.tags.sort();
            }
        },
        el: "#app",
        async mounted() {
            var result = await fetch("/api/values/first");

            var first = await result.json();

            if (first) {
                window.location.replace("http://localhost:5000/tutorial.html");
            }

            this.listUpdate();

            this.update();

            this.getSettings();

            this.tagsUpdate();
        }
    });
</script>
</body>


</html>

